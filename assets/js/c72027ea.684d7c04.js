"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[29512],{15680:(e,t,n)=>{n.d(t,{xA:()=>p,yg:()=>g});var a=n(96540);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),c=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(o.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(n),d=r,g=u["".concat(o,".").concat(d)]||u[d]||m[d]||i;return n?a.createElement(g,s(s({ref:t},p),{},{components:n})):a.createElement(g,s({ref:t},p))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,s=new Array(i);s[0]=d;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l[u]="string"==typeof e?e:r,s[1]=l;for(var c=2;c<i;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},48817:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>g,frontMatter:()=>l,metadata:()=>c,toc:()=>u});n(96540);var a=n(15680);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const l={sidebar_position:5,title:"DataProcessInstance",slug:"/generated/metamodel/entities/dataprocessinstance-datahub",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/generated/metamodel/entities/dataProcessInstance-datahub.md"},o="DataProcessInstance",c={unversionedId:"docs/generated/metamodel/entities/dataProcessInstance-datahub",id:"docs/generated/metamodel/entities/dataProcessInstance-datahub",title:"DataProcessInstance",description:"DataProcessInstance represents an individual execution run of a data pipeline or data processing task. While DataJob and DataFlow entities define the structure and logic of your data pipelines, DataProcessInstance captures the runtime behavior, tracking each specific execution with its inputs, outputs, status, and timing information.",source:"@site/genDocs/docs/generated/metamodel/entities/dataProcessInstance-datahub.md",sourceDirName:"docs/generated/metamodel/entities",slug:"/generated/metamodel/entities/dataprocessinstance-datahub",permalink:"/docs/generated/metamodel/entities/dataprocessinstance-datahub",draft:!1,editUrl:"https://github.com/datahub-project/datahub/blob/master/docs/generated/metamodel/entities/dataProcessInstance-datahub.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,title:"DataProcessInstance",slug:"/generated/metamodel/entities/dataprocessinstance-datahub",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/generated/metamodel/entities/dataProcessInstance-datahub.md"},sidebar:"overviewSidebar",previous:{title:"DataProcess",permalink:"/docs/generated/metamodel/entities/dataprocess"},next:{title:"DataProcessInstance",permalink:"/docs/generated/metamodel/entities/dataprocessinstance"}},p={},u=[{value:"Identity",id:"identity",level:2},{value:"Relationship to DataFlow and DataJob",id:"relationship-to-dataflow-and-datajob",level:3},{value:"Important Capabilities",id:"important-capabilities",level:2},{value:"Execution Tracking and Monitoring",id:"execution-tracking-and-monitoring",level:3},{value:"Run Status",id:"run-status",level:4},{value:"Run Results",id:"run-results",level:4},{value:"Execution Metadata",id:"execution-metadata",level:4},{value:"Process Properties",id:"process-properties",level:3},{value:"Instance-Level Lineage",id:"instance-level-lineage",level:3},{value:"Input Tracking",id:"input-tracking",level:4},{value:"Output Tracking",id:"output-tracking",level:4},{value:"Hierarchical Process Relationships",id:"hierarchical-process-relationships",level:3},{value:"Parent Instance",id:"parent-instance",level:4},{value:"Upstream Instances",id:"upstream-instances",level:4},{value:"Container-Based Processes",id:"container-based-processes",level:3},{value:"Code Examples",id:"code-examples",level:2},{value:"Creating and Tracking a Process Instance",id:"creating-and-tracking-a-process-instance",level:3},{value:"Tracking a Failed Process with Retry",id:"tracking-a-failed-process-with-retry",level:3},{value:"Creating a DataFlow Instance (DAG Run)",id:"creating-a-dataflow-instance-dag-run",level:3},{value:"Tracking Hierarchical Process Instances",id:"tracking-hierarchical-process-instances",level:3},{value:"Tracking ML Training Run in a Container",id:"tracking-ml-training-run-in-a-container",level:3},{value:"Querying Process Instance History via REST API",id:"querying-process-instance-history-via-rest-api",level:3},{value:"Querying Process Instance Run Events",id:"querying-process-instance-run-events",level:3},{value:"Integration Points",id:"integration-points",level:2},{value:"Orchestration Platforms",id:"orchestration-platforms",level:3},{value:"Airflow Integration",id:"airflow-integration",level:4},{value:"Other Orchestrators",id:"other-orchestrators",level:4},{value:"Relationship to DataJob and DataFlow",id:"relationship-to-datajob-and-dataflow",level:3},{value:"Relationship to Datasets",id:"relationship-to-datasets",level:3},{value:"GraphQL Resolvers",id:"graphql-resolvers",level:3},{value:"Notable Exceptions",id:"notable-exceptions",level:2},{value:"Instance vs Definition Distinction",id:"instance-vs-definition-distinction",level:3},{value:"Execution Status Lifecycle",id:"execution-status-lifecycle",level:3},{value:"Historical Data Retention",id:"historical-data-retention",level:3},{value:"Instance URN Stability",id:"instance-urn-stability",level:3},{value:"Technical Reference",id:"technical-reference",level:2}],m={toc:u},d="wrapper";function g(e){var{components:t}=e,n=s(e,["components"]);return(0,a.yg)(d,i(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){r(e,t,n[t])}))}return e}({},m,n),{components:t,mdxType:"MDXLayout"}),(0,a.yg)("h1",{id:"dataprocessinstance"},"DataProcessInstance"),(0,a.yg)("p",null,"DataProcessInstance represents an individual execution run of a data pipeline or data processing task. While DataJob and DataFlow entities define the structure and logic of your data pipelines, DataProcessInstance captures the runtime behavior, tracking each specific execution with its inputs, outputs, status, and timing information."),(0,a.yg)("p",null,"Think of it this way: if a DataJob is a recipe, a DataProcessInstance is one particular time you followed that recipe, recording when you started, what ingredients you used, what you produced, and whether it succeeded or failed."),(0,a.yg)("h2",{id:"identity"},"Identity"),(0,a.yg)("p",null,"DataProcessInstance entities are uniquely identified by a single field: an id string. This makes the identifier structure simpler than other entities but requires careful consideration when generating IDs."),(0,a.yg)("p",null,"The URN format is:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"urn:li:dataProcessInstance:<id>\n")),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"<id>")," field should be globally unique across all process instances and typically encodes information about the orchestrator, execution context, and run identifier. The Python SDK provides a helper that generates this ID from three components:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"orchestrator"),": The platform executing the process (e.g., ",(0,a.yg)("inlineCode",{parentName:"li"},"airflow"),", ",(0,a.yg)("inlineCode",{parentName:"li"},"spark"),", ",(0,a.yg)("inlineCode",{parentName:"li"},"dagster"),")"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"cluster"),": Optional environment identifier (e.g., ",(0,a.yg)("inlineCode",{parentName:"li"},"prod"),", ",(0,a.yg)("inlineCode",{parentName:"li"},"dev"),", ",(0,a.yg)("inlineCode",{parentName:"li"},"staging"),")"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"id"),": The execution-specific identifier (e.g., DAG run ID, job execution ID)")),(0,a.yg)("p",null,"Example URNs:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"urn:li:dataProcessInstance:abc123def456...\n")),(0,a.yg)("p",null,"The actual ID is a deterministic GUID generated from the orchestrator, cluster, and execution id:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},'from datahub.api.entities.dataprocess.dataprocess_instance import DataProcessInstance\n\n# The ID is automatically generated from these fields\ninstance = DataProcessInstance(\n    id="scheduled__2024-01-15T10:00:00+00:00",\n    orchestrator="airflow",\n    cluster="prod"\n)\n# Results in: urn:li:dataProcessInstance:<deterministic-guid>\n')),(0,a.yg)("h3",{id:"relationship-to-dataflow-and-datajob"},"Relationship to DataFlow and DataJob"),(0,a.yg)("p",null,"DataProcessInstance entities are linked to their template definitions through the ",(0,a.yg)("inlineCode",{parentName:"p"},"parentTemplate")," field in the ",(0,a.yg)("inlineCode",{parentName:"p"},"dataProcessInstanceRelationships")," aspect:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"DataJob Instance"),": When tracking a specific task execution, the ",(0,a.yg)("inlineCode",{parentName:"li"},"parentTemplate")," points to the DataJob URN"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"DataFlow Instance"),": When tracking an entire pipeline run (like an Airflow DAG run), the ",(0,a.yg)("inlineCode",{parentName:"li"},"parentTemplate")," points to the DataFlow URN"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Standalone Process"),": For ad-hoc or containerized processes, ",(0,a.yg)("inlineCode",{parentName:"li"},"parentTemplate")," can be null")),(0,a.yg)("p",null,"This relationship enables several important capabilities:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"Navigate from a job definition to all its historical runs"),(0,a.yg)("li",{parentName:"ul"},"Aggregate metrics across runs of the same job"),(0,a.yg)("li",{parentName:"ul"},"Compare current execution with historical patterns"),(0,a.yg)("li",{parentName:"ul"},"Debug failures by examining past successful runs")),(0,a.yg)("h2",{id:"important-capabilities"},"Important Capabilities"),(0,a.yg)("h3",{id:"execution-tracking-and-monitoring"},"Execution Tracking and Monitoring"),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"dataProcessInstanceRunEvent")," aspect (a timeseries aspect) tracks the lifecycle of each execution with high granularity:"),(0,a.yg)("h4",{id:"run-status"},"Run Status"),(0,a.yg)("p",null,"Process instances move through a simple lifecycle:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"STARTED"),": Process execution has begun"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"COMPLETE"),": Process execution has finished (with a result)")),(0,a.yg)("h4",{id:"run-results"},"Run Results"),(0,a.yg)("p",null,"When a process completes, the result type indicates the outcome:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"SUCCESS"),": Process completed successfully"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"FAILURE"),": Process failed with errors"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"SKIPPED"),": Process was skipped (e.g., due to conditions not being met)"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"UP_FOR_RETRY"),": Process failed but will be retried")),(0,a.yg)("h4",{id:"execution-metadata"},"Execution Metadata"),(0,a.yg)("p",null,"Each run event captures:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"timestampMillis"),": When the status change occurred"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"attempt"),": The attempt number (for retries)"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"durationMillis"),": Total execution time in milliseconds"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"nativeResultType"),': The platform-specific result status (e.g., "success" from Airflow)')),(0,a.yg)("p",null,"This enables monitoring dashboards to:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"Track real-time execution status"),(0,a.yg)("li",{parentName:"ul"},"Calculate success rates and failure patterns"),(0,a.yg)("li",{parentName:"ul"},"Identify performance degradation"),(0,a.yg)("li",{parentName:"ul"},"Alert on execution duration anomalies")),(0,a.yg)("h3",{id:"process-properties"},"Process Properties"),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"dataProcessInstanceProperties")," aspect captures metadata about the execution:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"name"),": Human-readable name for the execution"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"type"),": Process type - BATCH_SCHEDULED, BATCH_AD_HOC, or STREAMING"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"created"),": Audit stamp indicating when the instance was created"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"customProperties"),": Arbitrary key-value pairs for platform-specific metadata"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"externalUrl"),": Link to the execution in the orchestration platform (e.g., Airflow task instance page)")),(0,a.yg)("p",null,"Example use cases for customProperties:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},'properties={\n    "airflow_version": "2.7.0",\n    "executor": "CeleryExecutor",\n    "pool": "default_pool",\n    "queue": "default",\n    "operator": "PythonOperator"\n}\n')),(0,a.yg)("h3",{id:"instance-level-lineage"},"Instance-Level Lineage"),(0,a.yg)("p",null,"Unlike DataJob, which defines static lineage relationships, DataProcessInstance captures the actual inputs and outputs consumed and produced during a specific execution."),(0,a.yg)("h4",{id:"input-tracking"},"Input Tracking"),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"dataProcessInstanceInput")," aspect records:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"inputs"),": URNs of datasets or ML models consumed during this run"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"inputEdges"),": Rich edge information including timestamps and custom properties")),(0,a.yg)("h4",{id:"output-tracking"},"Output Tracking"),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"dataProcessInstanceOutput")," aspect records:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"outputs"),": URNs of datasets or ML models produced during this run"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"outputEdges"),": Rich edge information including timestamps and custom properties")),(0,a.yg)("p",null,"This enables powerful capabilities:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Point-in-time lineage"),": See exactly which data versions were used in a specific run"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Impact analysis"),": When a run fails, identify downstream processes that depend on its outputs"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Data quality tracking"),": Correlate data quality issues with specific process executions"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Reproducibility"),": Recreate exact execution conditions by knowing precise inputs")),(0,a.yg)("p",null,"Example: An Airflow task that succeeded might show it read from ",(0,a.yg)("inlineCode",{parentName:"p"},"dataset_v1")," and wrote to ",(0,a.yg)("inlineCode",{parentName:"p"},"dataset_v2"),", while a retry might show different input/output datasets if the data evolved."),(0,a.yg)("h3",{id:"hierarchical-process-relationships"},"Hierarchical Process Relationships"),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"dataProcessInstanceRelationships")," aspect supports complex execution hierarchies:"),(0,a.yg)("h4",{id:"parent-instance"},"Parent Instance"),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"parentInstance")," field links nested executions:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"DataFlow Instance (DAG Run)\n\u2514\u2500\u2500 DataJob Instance 1 (Task Run 1)\n\u2514\u2500\u2500 DataJob Instance 2 (Task Run 2)\n\u2514\u2500\u2500 DataJob Instance 3 (Task Run 3)\n")),(0,a.yg)("p",null,"This enables:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"Viewing all task runs within a DAG run"),(0,a.yg)("li",{parentName:"ul"},"Aggregating metrics at the DAG run level"),(0,a.yg)("li",{parentName:"ul"},"Understanding failure propagation in multi-stage pipelines")),(0,a.yg)("h4",{id:"upstream-instances"},"Upstream Instances"),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"upstreamInstances")," field creates dependencies between process instances:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"Process Instance A (completed) \u2192 Process Instance B (triggered)\n")),(0,a.yg)("p",null,"This captures dynamic execution dependencies, such as:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"Event-driven triggers"),(0,a.yg)("li",{parentName:"ul"},"Cross-DAG dependencies"),(0,a.yg)("li",{parentName:"ul"},"Dynamic fan-out/fan-in patterns")),(0,a.yg)("h3",{id:"container-based-processes"},"Container-Based Processes"),(0,a.yg)("p",null,"DataProcessInstance can represent processes that run within a Container (like an ML experiment) without being tied to a specific DataJob or DataFlow:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},'from datahub.emitter.mcp_builder import ContainerKey\n\ncontainer_key = ContainerKey(\n    platform="urn:li:dataPlatform:mlflow",\n    name="experiment_123",\n    env="PROD"\n)\n\ninstance = DataProcessInstance.from_container(\n    container_key=container_key,\n    id="training_run_456"\n)\n')),(0,a.yg)("p",null,"This is useful for:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"ML training runs in experiment tracking systems"),(0,a.yg)("li",{parentName:"ul"},"Notebook executions"),(0,a.yg)("li",{parentName:"ul"},"Ad-hoc data processing scripts"),(0,a.yg)("li",{parentName:"ul"},"Lambda/serverless function invocations")),(0,a.yg)("h2",{id:"code-examples"},"Code Examples"),(0,a.yg)("h3",{id:"creating-and-tracking-a-process-instance"},"Creating and Tracking a Process Instance"),(0,a.yg)("details",null,(0,a.yg)("summary",null,"Python SDK: Create and track a simple process instance"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},'# metadata-ingestion/examples/library/data_process_instance_create_simple.py\nimport time\n\nfrom datahub.api.entities.dataprocess.dataprocess_instance import (\n    DataProcessInstance,\n    InstanceRunResult,\n)\nfrom datahub.emitter.mcp import MetadataChangeProposalWrapper\nfrom datahub.emitter.rest_emitter import DatahubRestEmitter\nfrom datahub.metadata.schema_classes import DataProcessTypeClass\nfrom datahub.utilities.urns.data_job_urn import DataJobUrn\nfrom datahub.utilities.urns.dataset_urn import DatasetUrn\n\n# Create REST emitter\nemitter = DatahubRestEmitter(gms_server="http://localhost:8080")\n\n# Define the parent DataJob that this instance is executing\nparent_job_urn = DataJobUrn.create_from_string(\n    "urn:li:dataJob:(urn:li:dataFlow:(airflow,sales_pipeline,prod),process_sales_data)"\n)\n\n# Create a process instance for a specific execution\n# This might represent an Airflow task run on 2024-01-15 at 10:00:00\ninstance = DataProcessInstance(\n    id="scheduled__2024-01-15T10:00:00+00:00",\n    orchestrator="airflow",\n    cluster="prod",\n    template_urn=parent_job_urn,\n    type=DataProcessTypeClass.BATCH_SCHEDULED,\n    properties={\n        "airflow_version": "2.7.0",\n        "executor": "CeleryExecutor",\n        "pool": "default_pool",\n    },\n    url="https://airflow.company.com/dags/sales_pipeline/grid?dag_run_id=scheduled__2024-01-15T10:00:00+00:00&task_id=process_sales_data",\n    inlets=[\n        DatasetUrn.create_from_string(\n            "urn:li:dataset:(urn:li:dataPlatform:postgres,sales_db.raw_orders,PROD)"\n        )\n    ],\n    outlets=[\n        DatasetUrn.create_from_string(\n            "urn:li:dataset:(urn:li:dataPlatform:postgres,sales_db.processed_orders,PROD)"\n        )\n    ],\n)\n\n# Record the start of execution\nstart_time = int(time.time() * 1000)\ninstance.emit_process_start(\n    emitter=emitter,\n    start_timestamp_millis=start_time,\n    attempt=1,\n    emit_template=True,\n    materialize_iolets=True,\n)\n\nprint(f"Started tracking process instance: {instance.urn}")\n\n# Simulate process execution\nprint("Process is running...")\ntime.sleep(2)\n\n# Record the end of execution\nend_time = int(time.time() * 1000)\ninstance.emit_process_end(\n    emitter=emitter,\n    end_timestamp_millis=end_time,\n    result=InstanceRunResult.SUCCESS,\n    result_type="airflow",\n    attempt=1,\n    start_timestamp_millis=start_time,\n)\n\nprint(f"Completed tracking process instance with result: SUCCESS")\nprint(f"Duration: {end_time - start_time}ms")\n'))),(0,a.yg)("h3",{id:"tracking-a-failed-process-with-retry"},"Tracking a Failed Process with Retry"),(0,a.yg)("details",null,(0,a.yg)("summary",null,"Python SDK: Track a failed process execution and retry"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},'# metadata-ingestion/examples/library/data_process_instance_create_with_retry.py\nimport time\n\nfrom datahub.api.entities.dataprocess.dataprocess_instance import (\n    DataProcessInstance,\n    InstanceRunResult,\n)\nfrom datahub.emitter.rest_emitter import DatahubRestEmitter\nfrom datahub.metadata.schema_classes import DataProcessTypeClass\nfrom datahub.utilities.urns.data_job_urn import DataJobUrn\nfrom datahub.utilities.urns.dataset_urn import DatasetUrn\n\nemitter = DatahubRestEmitter(gms_server="http://localhost:8080")\n\nparent_job_urn = DataJobUrn.create_from_string(\n    "urn:li:dataJob:(urn:li:dataFlow:(airflow,etl_pipeline,prod),load_customer_data)"\n)\n\ninstance = DataProcessInstance(\n    id="scheduled__2024-01-15T14:30:00+00:00",\n    orchestrator="airflow",\n    cluster="prod",\n    template_urn=parent_job_urn,\n    type=DataProcessTypeClass.BATCH_SCHEDULED,\n    inlets=[\n        DatasetUrn.create_from_string(\n            "urn:li:dataset:(urn:li:dataPlatform:s3,customer_exports,PROD)"\n        )\n    ],\n    outlets=[\n        DatasetUrn.create_from_string(\n            "urn:li:dataset:(urn:li:dataPlatform:snowflake,analytics.customers,PROD)"\n        )\n    ],\n)\n\n# First attempt\nstart_time_attempt1 = int(time.time() * 1000)\ninstance.emit_process_start(\n    emitter=emitter,\n    start_timestamp_millis=start_time_attempt1,\n    attempt=1,\n    emit_template=True,\n    materialize_iolets=True,\n)\nprint("Attempt 1 started...")\n\ntime.sleep(1)\n\n# First attempt fails\nend_time_attempt1 = int(time.time() * 1000)\ninstance.emit_process_end(\n    emitter=emitter,\n    end_timestamp_millis=end_time_attempt1,\n    result=InstanceRunResult.UP_FOR_RETRY,\n    result_type="airflow",\n    attempt=1,\n    start_timestamp_millis=start_time_attempt1,\n)\nprint("Attempt 1 failed, will retry...")\n\ntime.sleep(2)\n\n# Second attempt (retry)\nstart_time_attempt2 = int(time.time() * 1000)\ninstance.emit_process_start(\n    emitter=emitter,\n    start_timestamp_millis=start_time_attempt2,\n    attempt=2,\n    emit_template=False,\n    materialize_iolets=False,\n)\nprint("Attempt 2 started (retry)...")\n\ntime.sleep(1)\n\n# Second attempt succeeds\nend_time_attempt2 = int(time.time() * 1000)\ninstance.emit_process_end(\n    emitter=emitter,\n    end_timestamp_millis=end_time_attempt2,\n    result=InstanceRunResult.SUCCESS,\n    result_type="airflow",\n    attempt=2,\n    start_timestamp_millis=start_time_attempt2,\n)\nprint("Attempt 2 succeeded!")\n'))),(0,a.yg)("h3",{id:"creating-a-dataflow-instance-dag-run"},"Creating a DataFlow Instance (DAG Run)"),(0,a.yg)("details",null,(0,a.yg)("summary",null,"Python SDK: Track an entire workflow execution"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},'# metadata-ingestion/examples/library/data_process_instance_create_from_dataflow.py\nimport time\n\nfrom datahub.api.entities.datajob import DataFlow\nfrom datahub.api.entities.dataprocess.dataprocess_instance import (\n    DataProcessInstance,\n    InstanceRunResult,\n)\nfrom datahub.emitter.rest_emitter import DatahubRestEmitter\n\nemitter = DatahubRestEmitter(gms_server="http://localhost:8080")\n\n# Define the DataFlow (Airflow DAG)\ndataflow = DataFlow(\n    orchestrator="airflow",\n    id="daily_reporting_pipeline",\n    env="prod",\n    description="Daily reporting pipeline that aggregates metrics",\n)\n\n# Create a DataProcessInstance for a specific DAG run\ndag_run_instance = DataProcessInstance.from_dataflow(\n    dataflow=dataflow,\n    id="scheduled__2024-01-15T00:00:00+00:00"\n)\n\n# Set properties specific to this DAG run\ndag_run_instance.properties = {\n    "execution_date": "2024-01-15",\n    "run_type": "scheduled",\n    "external_trigger": "false",\n}\ndag_run_instance.url = "https://airflow.company.com/dags/daily_reporting_pipeline/grid?dag_run_id=scheduled__2024-01-15T00:00:00+00:00"\n\n# Track DAG run start\nstart_time = int(time.time() * 1000)\ndag_run_instance.emit_process_start(\n    emitter=emitter,\n    start_timestamp_millis=start_time,\n    attempt=1,\n    emit_template=True,\n    materialize_iolets=True,\n)\nprint(f"DAG run started: {dag_run_instance.urn}")\n\n# Simulate DAG execution\ntime.sleep(3)\n\n# Track DAG run completion\nend_time = int(time.time() * 1000)\ndag_run_instance.emit_process_end(\n    emitter=emitter,\n    end_timestamp_millis=end_time,\n    result=InstanceRunResult.SUCCESS,\n    result_type="airflow",\n    attempt=1,\n    start_timestamp_millis=start_time,\n)\nprint(f"DAG run completed successfully in {end_time - start_time}ms")\n'))),(0,a.yg)("h3",{id:"tracking-hierarchical-process-instances"},"Tracking Hierarchical Process Instances"),(0,a.yg)("details",null,(0,a.yg)("summary",null,"Python SDK: Track a DAG run with child task instances"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},'# metadata-ingestion/examples/library/data_process_instance_create_hierarchical.py\nimport time\n\nfrom datahub.api.entities.datajob import DataFlow, DataJob\nfrom datahub.api.entities.dataprocess.dataprocess_instance import (\n    DataProcessInstance,\n    InstanceRunResult,\n)\nfrom datahub.emitter.rest_emitter import DatahubRestEmitter\nfrom datahub.utilities.urns.dataset_urn import DatasetUrn\n\nemitter = DatahubRestEmitter(gms_server="http://localhost:8080")\n\n# Define the DataFlow (Airflow DAG)\ndataflow = DataFlow(\n    orchestrator="airflow",\n    id="etl_pipeline",\n    env="prod",\n    description="ETL pipeline with multiple tasks",\n)\n\n# Define DataJobs (Tasks in the DAG)\nextract_job = DataJob(\n    id="extract_data",\n    flow_urn=dataflow.urn,\n    description="Extract data from source",\n)\n\n# Create a DAG run instance (parent)\ndag_run_id = "scheduled__2024-01-15T12:00:00+00:00"\ndag_run_instance = DataProcessInstance.from_dataflow(dataflow=dataflow, id=dag_run_id)\n\n# Track DAG run start\ndag_start_time = int(time.time() * 1000)\ndag_run_instance.emit_process_start(\n    emitter=emitter,\n    start_timestamp_millis=dag_start_time,\n    attempt=1,\n    emit_template=True,\n    materialize_iolets=False,\n)\nprint(f"DAG run started: {dag_run_instance.urn}")\n\n# Create task instance for extract_data (child of DAG run)\nextract_instance = DataProcessInstance.from_datajob(\n    datajob=extract_job,\n    id=f"{dag_run_id}__extract_data",\n)\nextract_instance.parent_instance = dag_run_instance.urn\nextract_instance.inlets = [\n    DatasetUrn.create_from_string(\n        "urn:li:dataset:(urn:li:dataPlatform:postgres,raw_db.orders,PROD)"\n    )\n]\nextract_instance.outlets = [\n    DatasetUrn.create_from_string(\n        "urn:li:dataset:(urn:li:dataPlatform:s3,staging/orders,PROD)"\n    )\n]\n\n# Track extract task execution\nextract_start_time = int(time.time() * 1000)\nextract_instance.emit_process_start(\n    emitter=emitter,\n    start_timestamp_millis=extract_start_time,\n    attempt=1,\n    emit_template=True,\n    materialize_iolets=True,\n)\ntime.sleep(1)\nextract_end_time = int(time.time() * 1000)\nextract_instance.emit_process_end(\n    emitter=emitter,\n    end_timestamp_millis=extract_end_time,\n    result=InstanceRunResult.SUCCESS,\n    attempt=1,\n    start_timestamp_millis=extract_start_time,\n)\n\n# Track DAG run completion\ndag_end_time = int(time.time() * 1000)\ndag_run_instance.emit_process_end(\n    emitter=emitter,\n    end_timestamp_millis=dag_end_time,\n    result=InstanceRunResult.SUCCESS,\n    attempt=1,\n    start_timestamp_millis=dag_start_time,\n)\nprint(f"DAG run completed successfully")\n'))),(0,a.yg)("h3",{id:"tracking-ml-training-run-in-a-container"},"Tracking ML Training Run in a Container"),(0,a.yg)("p",null,"ML training runs are a specialized use case of DataProcessInstance entities. In addition to standard process instance aspects, training runs can use ML-specific aspects:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Subtype"),": ",(0,a.yg)("inlineCode",{parentName:"li"},"MLAssetSubTypes.MLFLOW_TRAINING_RUN")," to identify the process as an ML training run"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"mlTrainingRunProperties"),": ML-specific metadata including training metrics, hyperparameters, and output URLs"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Relationships"),": Links to ML models (via ",(0,a.yg)("inlineCode",{parentName:"li"},"mlModelProperties.trainingJobs"),") and experiments (via ",(0,a.yg)("inlineCode",{parentName:"li"},"container")," aspect)")),(0,a.yg)("p",null,"For comprehensive documentation on ML training runs, including the complete workflow with experiments, models, and datasets, see the ",(0,a.yg)("a",{parentName:"p",href:"/docs/generated/metamodel/entities/mlmodel#training-runs-and-experiments"},"ML Model entity documentation"),"."),(0,a.yg)("details",null,(0,a.yg)("summary",null,"Python SDK: Track a standalone ML training run"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},'# metadata-ingestion/examples/library/data_process_instance_create_ml_training.py\nimport time\n\nfrom datahub.api.entities.dataprocess.dataprocess_instance import (\n    DataProcessInstance,\n    InstanceRunResult,\n)\nfrom datahub.emitter.mcp_builder import ContainerKey\nfrom datahub.emitter.rest_emitter import DatahubRestEmitter\nfrom datahub.metadata.schema_classes import DataProcessTypeClass\nfrom datahub.utilities.urns.dataset_urn import DatasetUrn\n\nemitter = DatahubRestEmitter(gms_server="http://localhost:8080")\n\n# Define the ML experiment container\nexperiment_container = ContainerKey(\n    platform="urn:li:dataPlatform:mlflow",\n    name="customer_churn_experiment",\n    env="PROD"\n)\n\n# Create a process instance for a training run\ntraining_run = DataProcessInstance.from_container(\n    container_key=experiment_container,\n    id="run_abc123def456"\n)\n\n# Set training-specific properties\ntraining_run.type = DataProcessTypeClass.BATCH_AD_HOC\ntraining_run.properties = {\n    "model_type": "RandomForestClassifier",\n    "hyperparameters": "n_estimators=100,max_depth=10",\n    "framework": "scikit-learn",\n    "framework_version": "1.3.0",\n}\ntraining_run.url = "https://mlflow.company.com/experiments/5/runs/abc123def456"\n\n# Set training data inputs\ntraining_run.inlets = [\n    DatasetUrn.create_from_string(\n        "urn:li:dataset:(urn:li:dataPlatform:snowflake,ml.training_data,PROD)"\n    )\n]\n\n# Set model output\ntraining_run.outlets = [\n    DatasetUrn.create_from_string(\n        "urn:li:mlModel:(urn:li:dataPlatform:mlflow,customer_churn_model_v2,PROD)"\n    )\n]\n\n# Track training start\nstart_time = int(time.time() * 1000)\ntraining_run.emit_process_start(\n    emitter=emitter,\n    start_timestamp_millis=start_time,\n    attempt=1,\n    emit_template=False,\n    materialize_iolets=True,\n)\nprint("ML training run started...")\n\n# Simulate training\ntime.sleep(5)\n\n# Track training completion\nend_time = int(time.time() * 1000)\ntraining_run.emit_process_end(\n    emitter=emitter,\n    end_timestamp_millis=end_time,\n    result=InstanceRunResult.SUCCESS,\n    result_type="mlflow",\n    attempt=1,\n    start_timestamp_millis=start_time,\n)\nprint(f"ML training completed in {(end_time - start_time)/1000:.2f}s")\n'))),(0,a.yg)("h3",{id:"querying-process-instance-history-via-rest-api"},"Querying Process Instance History via REST API"),(0,a.yg)("details",null,(0,a.yg)("summary",null,"REST API: Query execution history for a DataJob"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"# Get all process instances for a specific DataJob\ncurl -X GET 'http://localhost:8080/relationships?direction=INCOMING&urn=urn%3Ali%3AdataJob%3A%28urn%3Ali%3AdataFlow%3A%28airflow%2Csales_pipeline%2Cprod%29%2Cprocess_sales_data%29&types=InstanceOf'\n")),(0,a.yg)("p",null,"Response:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "start": 0,\n  "count": 10,\n  "relationships": [\n    {\n      "type": "InstanceOf",\n      "entity": "urn:li:dataProcessInstance:abc123..."\n    },\n    {\n      "type": "InstanceOf",\n      "entity": "urn:li:dataProcessInstance:def456..."\n    }\n  ],\n  "total": 25\n}\n')),(0,a.yg)("p",null,"To get full details of each instance, fetch the entities:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"curl 'http://localhost:8080/entities/urn%3Ali%3AdataProcessInstance%3Aabc123...'\n")),(0,a.yg)("p",null,"Response includes all aspects:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "urn": "urn:li:dataProcessInstance:abc123...",\n  "aspects": {\n    "dataProcessInstanceProperties": {\n      "name": "scheduled__2024-01-15T10:00:00+00:00",\n      "type": "BATCH_SCHEDULED",\n      "created": {\n        "time": 1705318800000,\n        "actor": "urn:li:corpuser:datahub"\n      },\n      "customProperties": {\n        "airflow_version": "2.7.0"\n      }\n    },\n    "dataProcessInstanceInput": {\n      "inputs": [\n        "urn:li:dataset:(urn:li:dataPlatform:postgres,sales_db.raw_orders,PROD)"\n      ]\n    },\n    "dataProcessInstanceOutput": {\n      "outputs": [\n        "urn:li:dataset:(urn:li:dataPlatform:postgres,sales_db.processed_orders,PROD)"\n      ]\n    },\n    "dataProcessInstanceRelationships": {\n      "parentTemplate": "urn:li:dataJob:(urn:li:dataFlow:(airflow,sales_pipeline,prod),process_sales_data)"\n    }\n  }\n}\n'))),(0,a.yg)("h3",{id:"querying-process-instance-run-events"},"Querying Process Instance Run Events"),(0,a.yg)("details",null,(0,a.yg)("summary",null,"GraphQL: Query run history with status and timing"),(0,a.yg)("p",null,"The DataHub GraphQL API provides a ",(0,a.yg)("inlineCode",{parentName:"p"},"runs")," field on DataJob entities to query execution history:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-graphql"},'query GetJobRuns {\n  dataJob(\n    urn: "urn:li:dataJob:(urn:li:dataFlow:(airflow,sales_pipeline,prod),process_sales_data)"\n  ) {\n    runs(start: 0, count: 10) {\n      total\n      runs {\n        urn\n        created {\n          time\n        }\n        properties {\n          name\n          type\n          externalUrl\n          customProperties {\n            key\n            value\n          }\n        }\n        relationships {\n          parentTemplate\n          parentInstance\n        }\n        inputs {\n          urn\n          type\n        }\n        outputs {\n          urn\n          type\n        }\n      }\n    }\n  }\n}\n')),(0,a.yg)("p",null,"Note: The timeseries ",(0,a.yg)("inlineCode",{parentName:"p"},"dataProcessInstanceRunEvent")," aspect contains the actual run status, timing, and results. To query this timeseries data, use the timeseries aggregation APIs or directly query the timeseries index.")),(0,a.yg)("h2",{id:"integration-points"},"Integration Points"),(0,a.yg)("h3",{id:"orchestration-platforms"},"Orchestration Platforms"),(0,a.yg)("p",null,"DataProcessInstance is the bridge between orchestration platforms and DataHub's metadata layer:"),(0,a.yg)("h4",{id:"airflow-integration"},"Airflow Integration"),(0,a.yg)("p",null,"The DataHub Airflow plugin automatically creates DataProcessInstance entities for:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"DAG runs"),": Each Airflow DagRun becomes a DataProcessInstance with the DataFlow as its parent"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Task runs"),": Each TaskInstance becomes a DataProcessInstance with the DataJob as its parent")),(0,a.yg)("p",null,"The plugin tracks:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"Start and end times from TaskInstance"),(0,a.yg)("li",{parentName:"ul"},"Success/failure status"),(0,a.yg)("li",{parentName:"ul"},"Retry attempts"),(0,a.yg)("li",{parentName:"ul"},"Actual datasets read/written (via lineage backend)")),(0,a.yg)("p",null,"Configuration example:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},"from datahub_airflow_plugin.datahub_listener import DatahubListener\n\n# In your airflow.cfg or environment:\n# AIRFLOW__DATAHUB__ENABLED=true\n# AIRFLOW__DATAHUB__DATAHUB_CONN_ID=datahub_rest_default\n")),(0,a.yg)("h4",{id:"other-orchestrators"},"Other Orchestrators"),(0,a.yg)("p",null,"Similar patterns apply for:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Dagster"),": Dagster runs and step executions"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Prefect"),": Flow runs and task runs"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Spark"),": Spark application executions"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"dbt"),": dbt run executions"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Fivetran"),": Sync executions")),(0,a.yg)("h3",{id:"relationship-to-datajob-and-dataflow"},"Relationship to DataJob and DataFlow"),(0,a.yg)("p",null,"DataProcessInstance complements DataJob and DataFlow entities:"),(0,a.yg)("table",null,(0,a.yg)("thead",{parentName:"table"},(0,a.yg)("tr",{parentName:"thead"},(0,a.yg)("th",{parentName:"tr",align:null},"Entity"),(0,a.yg)("th",{parentName:"tr",align:null},"Purpose"),(0,a.yg)("th",{parentName:"tr",align:null},"Cardinality"),(0,a.yg)("th",{parentName:"tr",align:null},"Example"))),(0,a.yg)("tbody",{parentName:"table"},(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"DataFlow"),(0,a.yg)("td",{parentName:"tr",align:null},"Pipeline definition"),(0,a.yg)("td",{parentName:"tr",align:null},"1 per logical pipeline"),(0,a.yg)("td",{parentName:"tr",align:null},'Airflow DAG "sales_pipeline"')),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"DataJob"),(0,a.yg)("td",{parentName:"tr",align:null},"Task definition"),(0,a.yg)("td",{parentName:"tr",align:null},"N per DataFlow"),(0,a.yg)("td",{parentName:"tr",align:null},'Airflow Task "process_sales_data"')),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"DataProcessInstance"),(0,a.yg)("td",{parentName:"tr",align:null},"Execution run"),(0,a.yg)("td",{parentName:"tr",align:null},"M per DataJob/DataFlow"),(0,a.yg)("td",{parentName:"tr",align:null},"Task run on 2024-01-15 10:00")))),(0,a.yg)("p",null,"Key differences:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Static vs Dynamic"),": DataJob/DataFlow define what should happen; DataProcessInstance records what did happen"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Lineage"),": DataJob defines expected lineage; DataProcessInstance captures actual lineage for that run"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Metadata"),": DataJob describes the task; DataProcessInstance describes the execution")),(0,a.yg)("h3",{id:"relationship-to-datasets"},"Relationship to Datasets"),(0,a.yg)("p",null,"DataProcessInstance creates instance-level lineage to datasets:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"Dataset Version 1 \u2500\u2510\n                   \u251c\u2500> DataProcessInstance (Run #1) \u2500> Dataset Version 2\nDataset Version 1 \u2500\u2518\n\nDataset Version 2 \u2500\u2510\n                   \u251c\u2500> DataProcessInstance (Run #2) \u2500> Dataset Version 3\nDataset Version 2 \u2500\u2518\n")),(0,a.yg)("p",null,"This enables:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Point-in-time lineage"),": Which data version was used in which run"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Data provenance"),": Trace data quality issues to specific executions"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Reproducibility"),": Understand exact conditions of past runs")),(0,a.yg)("h3",{id:"graphql-resolvers"},"GraphQL Resolvers"),(0,a.yg)("p",null,"DataProcessInstance entities are exposed via GraphQL through several resolvers:"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},(0,a.yg)("strong",{parentName:"p"},"DataJobRunsResolver"),": Fetches process instances for a DataJob"),(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},"Queries by ",(0,a.yg)("inlineCode",{parentName:"li"},"parentTemplate")," field"),(0,a.yg)("li",{parentName:"ul"},"Sorts by creation time (most recent first)"),(0,a.yg)("li",{parentName:"ul"},"Returns only instances with run events"))),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},(0,a.yg)("strong",{parentName:"p"},"EntityRunsResolver"),": Generic resolver for any entity's runs"),(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},"Used for DataFlow runs"),(0,a.yg)("li",{parentName:"ul"},"Similar filtering and sorting logic"))),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},(0,a.yg)("strong",{parentName:"p"},"DataProcessInstanceMapper"),": Converts internal representation to GraphQL type"),(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},"Maps all aspects to GraphQL fields"),(0,a.yg)("li",{parentName:"ul"},"Handles relationships to parent entities")))),(0,a.yg)("p",null,"The GraphQL schema exposes:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-graphql"},"type DataJob {\n  runs(start: Int, count: Int): DataProcessInstanceResult\n}\n\ntype DataFlow {\n  runs(start: Int, count: Int): DataProcessInstanceResult\n}\n\ntype DataProcessInstance {\n  urn: String!\n  properties: DataProcessInstanceProperties\n  relationships: DataProcessInstanceRelationships\n  inputs: [Entity]\n  outputs: [Entity]\n  # Note: Run events are in timeseries data\n}\n")),(0,a.yg)("h2",{id:"notable-exceptions"},"Notable Exceptions"),(0,a.yg)("h3",{id:"instance-vs-definition-distinction"},"Instance vs Definition Distinction"),(0,a.yg)("p",null,"A common pitfall is confusing instance-level metadata with definition-level metadata:"),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Wrong"),": Attaching tags to a DataProcessInstance"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},'# Don\'t do this - tags belong on the DataJob\ninstance = DataProcessInstance(...)\n# instance.tags = ["pii", "critical"]  # This doesn\'t exist\n')),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Right"),": Attach tags to the DataJob, use properties for run-specific metadata"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},'# Tag the DataJob definition\ndatajob.tags = ["pii", "critical"]\n\n# Use properties for run-specific metadata\ninstance = DataProcessInstance(...)\ninstance.properties = {"data_size_mb": "150", "row_count": "1000000"}\n')),(0,a.yg)("h3",{id:"execution-status-lifecycle"},"Execution Status Lifecycle"),(0,a.yg)("p",null,"DataProcessInstance status follows a simple state machine:"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},"STARTED event emitted when execution begins"),(0,a.yg)("li",{parentName:"ol"},"COMPLETE event emitted when execution finishes (with SUCCESS/FAILURE/SKIPPED/UP_FOR_RETRY result)")),(0,a.yg)("p",null,"Common mistakes:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Forgetting to emit COMPLETE"),": Always emit both START and END events"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Multiple COMPLETE events"),": Retries should have the same instance but different attempt numbers"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Wrong result types"),": UP_FOR_RETRY is for transient failures that will retry; FAILURE is final")),(0,a.yg)("h3",{id:"historical-data-retention"},"Historical Data Retention"),(0,a.yg)("p",null,"DataProcessInstance entities can accumulate quickly in high-frequency pipelines:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"A pipeline running every 5 minutes creates 288 instances per day"),(0,a.yg)("li",{parentName:"ul"},"A pipeline with 10 tasks creates 2,880 instances per day"),(0,a.yg)("li",{parentName:"ul"},"Over a year, this could be over 1 million instances")),(0,a.yg)("p",null,"Considerations:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Retention policies"),": Consider implementing retention policies to delete old instances"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Aggregation"),": For long-term analytics, aggregate instance data into summary metrics"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Sampling"),": For very high-frequency processes, consider sampling (e.g., track every 10th execution)"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Storage costs"),": Timeseries data (run events) can grow large; monitor index sizes")),(0,a.yg)("p",null,"DataHub does not automatically clean up old DataProcessInstance entities. You should implement cleanup based on your needs:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},'# Example: Cleanup instances older than 90 days\nimport datetime\nfrom datahub.emitter.rest_emitter import DatahubRestEmitter\n\nemitter = DatahubRestEmitter(gms_server="http://localhost:8080")\n\ncutoff_time = int((datetime.datetime.now() - datetime.timedelta(days=90)).timestamp() * 1000)\n\n# Query for old instances and soft-delete them\n# (Implementation depends on your retention requirements)\n')),(0,a.yg)("h3",{id:"instance-urn-stability"},"Instance URN Stability"),(0,a.yg)("p",null,"The DataProcessInstance URN is generated from the orchestrator, cluster, and id fields. This means:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Same id = Same URN"),": Reusing the same id overwrites the previous instance"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Unique ids required"),": Each execution must have a unique id"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Orchestrator changes"),": Changing the orchestrator name creates a new entity lineage")),(0,a.yg)("p",null,"Best practices:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"Use execution-specific IDs (timestamps, run IDs, UUIDs)"),(0,a.yg)("li",{parentName:"ul"},"Don't reuse IDs across different executions"),(0,a.yg)("li",{parentName:"ul"},"Keep orchestrator names consistent"),(0,a.yg)("li",{parentName:"ul"},"Include environment (cluster) in the ID if running the same pipeline in multiple environments")),(0,a.yg)("h2",{id:"technical-reference"},"Technical Reference"),(0,a.yg)("p",null,"For technical details about fields, searchability, and relationships, view the ",(0,a.yg)("strong",{parentName:"p"},"Columns")," tab in DataHub."))}g.isMDXComponent=!0}}]);